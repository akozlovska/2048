class e{constructor(e,l,t){this.cellElement=e,this.x=l,this.y=t,this.cellElement.style.setProperty("--x",l),this.cellElement.style.setProperty("--y",t),this.block=null,this.mergeBlock=null}get block(){return this._block}set block(e){this._block=e,null!==e&&(this._block.x=this.x,this._block.y=this.y)}get mergeBlock(){return this._mergeBlock}set mergeBlock(e){this._mergeBlock=e,null!==e&&(this._mergeBlock.x=this.x,this._mergeBlock.y=this.y)}canAccept(e){return null===this.block||null===this.mergeBlock&&this.block.value===e.value}mergeBlocks(){if(null!==this.block&&null!==this.mergeBlock)return this.block.value=this.block.value+this.mergeBlock.value,this.mergeBlock.blockElement.remove(),this.mergeBlock=null,this.block.value}}var l={Field:class{constructor(l){this.cells=(function(e){let l=[];for(let t=0;t<16;t++){let t=document.createElement("div");t.classList.add("cell"),l.push(t),e.append(t)}return l})(l).map((l,t)=>new e(l,t%4,Math.floor(t/4)))}get cellsByColumns(){return this.cells.reduce((e,l)=>(e[l.x]=e[l.x]||[],e[l.x][l.y]=l,e),[])}get cellsByRows(){return this.cells.reduce((e,l)=>(e[l.y]=e[l.y]||[],e[l.y][l.x]=l,e),[])}get randomEmptyCell(){let e=this.cells.filter(e=>null===e.block),l=Math.floor(Math.random()*e.length);return e[l]}}}.Field,t={Block:class{constructor(e,l=.1>Math.random()?4:2){this.blockElement=document.createElement("div"),this.blockElement.classList.add("block"),e.append(this.blockElement),this.value=l}get value(){return this._value}set value(e){for(let l of(this._value=e,this.blockElement.textContent=e,this.blockElement.classList))l.includes("block--")&&this.blockElement.classList.remove(l);this.blockElement.classList.add(`block--${e}`)}set x(e){this._x=e,this.blockElement.style.setProperty("--x",e)}set y(e){this._y=e,this.blockElement.style.setProperty("--y",e)}}}.Block;const s=document.querySelector(".game-field");let c=new l(s);const o=document.querySelector(".game-score");let r=0;const n=document.querySelector(".message-start"),i=document.querySelector(".message-lose"),a=document.querySelector(".message-win"),u=document.querySelector(".start"),m=()=>{window.addEventListener("keydown",d,{once:!0})},h=()=>{for(;s.firstChild;)s.removeChild(s.lastChild);c=new l(s),r=0,o.textContent=r};u.addEventListener("click",()=>{"Restart"===u.textContent?(i.classList.contains("hidden")||i.classList.add("hidden"),a.classList.contains("hidden")||a.classList.add("hidden"),h()):(n.classList.add("hidden"),u.classList.remove("start"),u.classList.add("restart"),u.textContent="Restart"),c.randomEmptyCell.block=new t(s),c.randomEmptyCell.block=new t(s),m()}),u.addEventListener("keydown",e=>{("Enter"===e.code||"Space"===e.code)&&e.preventDefault()});const d=e=>{switch(e.key){case"ArrowRight":if(!E()){m();return}y();break;case"ArrowLeft":if(!f()){m();return}b();break;case"ArrowUp":if(!p()){m();return}g();break;case"ArrowDown":if(!w()){m();return}v();break;default:m();return}if(c.cells.forEach(e=>{let l=e.mergeBlocks();l&&(r+=l)}),o.textContent=r,c.cells.some(e=>e.block&&2048===e.block.value)){a.classList.remove("hidden");return}if(c.randomEmptyCell.block=new t(s),!p()&&!w()&&!f()&&!E()){i.classList.remove("hidden");return}m()},k=e=>{e.forEach(e=>{for(let l=1;l<e.length;l++){let t=e[l];if(null===t.block)continue;let s=null;for(let c=l-1;c>=0;c--){let l=e[c];if(!l.canAccept(t.block))break;s=l}null!==s&&(s.block?s.mergeBlock=t.block:s.block=t.block,t.block=null)}})},b=()=>k(c.cellsByRows),y=()=>k(c.cellsByRows.map(e=>[...e].reverse())),g=()=>k(c.cellsByColumns),v=()=>k(c.cellsByColumns.map(e=>[...e].reverse())),B=e=>e.some(e=>e.some((l,t)=>0!==t&&null!==l.block&&e[t-1].canAccept(l.block))),f=()=>B(c.cellsByRows),E=()=>B(c.cellsByRows.map(e=>[...e].reverse())),p=()=>B(c.cellsByColumns),w=()=>B(c.cellsByColumns.map(e=>[...e].reverse()));
//# sourceMappingURL=index.81fd8437.js.map
